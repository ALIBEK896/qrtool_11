<script>
    // Инициализация переменной для сканера
    let scanner = null;

    // Функция для запуска сканера
    async function startScanner() {
        const readerElement = document.getElementById("reader");
        const resultElement = document.getElementById("qr-result");

        // Инициализация сканера через API библиотеки
        scanner = new Html5Qrcode("reader");

        // Запуск сканера
        try {
            await scanner.start(
                { facingMode: "environment" },  // Используем заднюю камеру
                { fps: 10, qrbox: 250 },       // Настройки сканера (частота кадров, размер области для QR)
                (decodedText) => {             // Обработчик успешного сканирования
                    resultElement.textContent = `QR-код: ${decodedText}`;
                    stopScanner();             // Остановка сканера после нахождения кода
                },
                (errorMessage) => {            // Обработчик ошибок
                    console.warn("Ошибка сканирования: ", errorMessage);
                }
            );
        } catch (error) {
            console.error("Ошибка при запуске сканера: ", error);
        }
    }

    // Функция для остановки сканера
    function stopScanner() {
        if (scanner) {
            scanner.stop();
            document.getElementById("reader").innerHTML = "";
            console.log("Сканер остановлен.");
        }
    }

    // Запуск сканера при загрузке страницы
    window.onload = () => {
        startScanner();
    };
</script>
